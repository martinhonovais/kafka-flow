<ngb-alert #successAlert *ngIf="successMessage" type="success" (closed)="successMessage=''">
  <div class="text-center"><b>Success! </b> <span class="text-center">{{ successMessage}}</span></div>
</ngb-alert>
<div class="container" *ngFor="let group of groups | callback: removeReadonly">
  <div class="card my-3">
    <div class="card-body">
      <h3>Group Id: {{ group.groupId }}</h3>
      <div *ngFor="let consumer of group.consumers">
        <h4>Consumer: {{ consumer.consumerName }}</h4>
        <h4>Status: <span [ngClass]="{
                  'text-success': consumer.flowStatus == 'Running',
                  'text-warning': consumer.flowStatus == 'Paused',
                  'text-danger': consumer.flowStatus == 'NotRunning'
                  }">{{consumer.flowStatus}}</span></h4>
        <h4>Lag: 55</h4>
        <h4>Workers: {{consumer.workersCount}}</h4>
        <div class="mt-3 mb-3">
          <button class="btn btn-outline-success" type="button" (click)="openResumeModal(group.groupId, consumer.consumerName)" *ngIf="consumer.flowStatus == 'Paused'">Resume</button>
          <button class="btn btn-outline-warning ml-2" type="button" (click)="openPauseModal(group.groupId, consumer.consumerName)" *ngIf="consumer.flowStatus == 'Running'">Pause</button>
          <button class="btn btn-outline-danger ml-2" type="button" (click)="openRestartModal(group.groupId, consumer.consumerName)">Restart</button>
          <button class="btn btn-outline-info ml-2" type="button" (click)="openRewindModal(group.groupId, consumer.consumerName)">Rewind Offset</button>
          <button class="btn btn-outline-secondary ml-2" type="button" (click)="openResetModal(group.groupId, consumer.consumerName)">Reset Offset</button>
          <button class="btn btn-outline-success ml-2" type="button" (click)="openWorkersCountModal(group.groupId, consumer.consumerName, consumer.workersCount)">Update number of workers</button>
        </div>
        <ng-template let-partitionAssignments ngFor [ngForOf]="consumer.partitionAssignments | groupBy:'topic'">
          <p class="mb-0 font-weight-bold">Topic: {{partitionAssignments.key}}</p>
          <table class="table table-striped table-hover mt-1">
            <thead>
            <tr>
              <th>Hostname</th>
              <th>Partitions</th>
              <th>Lag</th>
              <th>Status</th>
              <th>LastUpdate</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <ng-template let-partitionAssignment ngFor [ngForOf]="partitionAssignments.value | sort:'hostName'">
              <ng-template [ngIf]="partitionAssignment.pausedPartitions && partitionAssignment.pausedPartitions.length > 0">
                <tr>
                  <td class="text-left">{{partitionAssignment.hostName}}</td>
                  <td class="text-left">{{partitionAssignment.pausedPartitions}}</td>
                  <td class="text-left">0</td>
                  <td class="text-left"><span class="font-weight-bold text-warning">Paused</span></td>
                  <td class="text-left"><span [ngClass]="{
                    'text-success': diffFromNowLessThan(partitionAssignment.lastUpdate, 5),
                    'text-warning': diffFromNowGreaterThanAndLessThan(partitionAssignment.lastUpdate, 5, 10),
                    'text-danger': diffFromNowGreaterThan(partitionAssignment.lastUpdate, 10)
                    }">{{partitionAssignment.lastUpdate}}</span></td>
                  <td class="text-left">
                    <button class="btn btn-sm btn-success" type="button">Resume</button>
                    <button class="btn btn-sm btn-info ml-1" type="button">Rewind Offset</button>
                    <button class="btn btn-sm btn-secondary ml-1" type="button">Reset Offset</button>
                  </td>
                </tr>
              </ng-template>
              <ng-template [ngIf]="partitionAssignment.runningPartitions?.length > 0">
                <tr>
                  <td class="text-left">{{partitionAssignment.hostName}}</td>
                  <td class="text-left">{{partitionAssignment.runningPartitions}}</td>
                  <td class="text-left">0</td>
                  <td class="text-left">
                    <div *ngIf="diffFromNowGreaterThan(partitionAssignment.lastUpdate, 10);then consumer_lost else consumer_on"></div>
                    <ng-template #consumer_lost><span>-</span></ng-template>
                    <ng-template #consumer_on><span class="font-weight-bold text-success">Running</span></ng-template>
                  </td>
                  <td class="text-left"><span [ngClass]="{
                    'text-success': diffFromNowLessThan(partitionAssignment.lastUpdate, 5),
                    'text-warning': diffFromNowGreaterThanAndLessThan(partitionAssignment.lastUpdate, 5, 10),
                    'text-danger': diffFromNowGreaterThan(partitionAssignment.lastUpdate, 10)
                    }">{{partitionAssignment.lastUpdate | date: 'medium'}}</span></td>
                  <td class="text-left">
                    <button class="btn btn-sm btn-warning" type="button">Pause</button>
                    <button class="btn btn-sm btn-info ml-1" type="button">Rewind Offset</button>
                    <button class="btn btn-sm btn-secondary ml-1" type="button">Reset Offset</button>
                  </td>
                </tr>
              </ng-template>
            </ng-template>
            </tbody>
          </table>
        </ng-template>
        <hr />
      </div>
    </div>
  </div>
</div>
